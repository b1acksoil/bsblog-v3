<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>WSL on BsBlog</title><link>https://sorabs.cc/tags/wsl/</link><description>Recent content in WSL on BsBlog</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><atom:link href="https://sorabs.cc/tags/wsl/index.xml" rel="self" type="application/rss+xml"/><item><title>使用 WSL2 部署 Arch Linux 环境</title><link>https://sorabs.cc/posts/wsl2-arch/</link><pubDate>Sat, 01 Oct 2022 09:38:08 +0800</pubDate><guid>https://sorabs.cc/posts/wsl2-arch/</guid><description>&lt;img src="https://sorabs.cc/posts/wsl2-arch/cover.jpg" alt="Featured image of post 使用 WSL2 部署 Arch Linux 环境" />&lt;p>最近入了 Arch Linux 的坑，手上没有空闲的机子可以装着玩，虚拟机又有点膈应的感觉，就找了找资料在 WSL2 上装了体验一下。&lt;/p>
&lt;p>关于 WSL1 和 WSL2 的区别，不在本文的讨论范围内，可以前往&lt;a class="link" href="https://learn.microsoft.com/zh-cn/windows/wsl/compare-versions" target="_blank" rel="noopener"
>微软的官方说明&lt;/a>查看。&lt;/p>
&lt;p>本文中，以 &lt;code>&amp;gt;&lt;/code> 开头的命令为 Powershell 命令，&lt;code>#&lt;/code> 开头为 Arch 中的 &lt;code>root&lt;/code> 用户命令，&lt;code>$&lt;/code> 开头为 Arch 中的普通用户命令。&lt;/p>
&lt;h2 id="准备工作">准备工作&lt;/h2>
&lt;ul>
&lt;li>Windows 10 2004 版本或以上（我使用的是 Windows 11）&lt;/li>
&lt;li>可选功能中打开&lt;strong>适用于 Linux 的 Windows 子系统&lt;/strong>和&lt;strong>虚拟机平台&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>首先前往 &lt;a class="link" href="https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi" target="_blank" rel="noopener"
>&lt;strong>这里&lt;/strong>&lt;/a> 下载 WSL 的内核更新包，不然没法安装。&lt;/p>
&lt;p>安装后将 WSL 的默认版本设置为 WSL2：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-powershell" data-lang="powershell">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="n">wsl&lt;/span> &lt;span class="p">-&lt;/span>&lt;span class="n">-set-default-version&lt;/span> &lt;span class="mf">2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="安装-arch">安装 Arch&lt;/h2>
&lt;p>前往 &lt;a class="link" href="https://github.com/yuk7/ArchWSL" target="_blank" rel="noopener"
>项目仓库 (yuk7/ArchWSL)&lt;/a> 的 &lt;a class="link" href="https://github.com/yuk7/ArchWSL/releases" target="_blank" rel="noopener"
>Releases&lt;/a> 页面下载最新的 &lt;code>Arch.zip&lt;/code>，并解压到具有写权限的空文件夹里。留意 &lt;code>Arch.exe&lt;/code> 的名称，&lt;code>.exe&lt;/code> 前的部分会作为稍后在 WSL 内注册的发行版名称，例如改名成 &lt;code>ArchLinux.exe&lt;/code>，稍后的实例就叫 &lt;code>ArchLinux&lt;/code>。&lt;/p>
&lt;div class="tip tip-note">
&lt;div class="tip-header">多个 Arch 共存&lt;/div>
&lt;div class="tip-content">由于这里的 Arch 是通过文件安装，只要将 &lt;code>exe&lt;/code> 文件复制并改名即可。注意改名后的文件不要和已有的实例名称重复。&lt;/div>
&lt;/div>
&lt;p>双击打开 &lt;code>Arch.exe&lt;/code>，程序会自动注册 rootfs 和注册表配置。&lt;/p>
&lt;h2 id="创建默认用户">创建默认用户&lt;/h2>
&lt;p>直接使用 &lt;code>root&lt;/code> 用户很不安全，这里我们创建一个新的用户代替 &lt;code>root&lt;/code> 进行日常使用。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># useradd -m -G wheel -s /bin/bash bs
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这里的 &lt;code>bs&lt;/code> 是用户名称，将其换成你自己的。然后为新用户设置密码：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># passwd bs
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>为了使新用户可以使用 &lt;code>sudo&lt;/code> 权限，编辑 &lt;code>/etc/sudoers&lt;/code> 文件，找到 &lt;code>root ALL=(ALL:ALL) ALL&lt;/code>，在其下添加一行 &lt;code>bs ALL=(ALL:ALL) ALL&lt;/code> （&lt;code>bs&lt;/code> 同样换成刚刚的用户名）；并找到 &lt;code>#%wheel ALL=(ALL:ALL) ALL&lt;/code>，将其取消注释（去掉最前面的 &lt;code>#&lt;/code>）&lt;/p>
&lt;div class="tip tip-note">
&lt;div class="tip-header">找不到编辑器&lt;/div>
&lt;div class="tip-content">如果没有自己常用的编辑器（如 vim），可以先跳到下面的 Pacman 配置小节，然后自行安装。&lt;/div>
&lt;/div>
&lt;p>改好了是这样的：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">root ALL=(ALL:ALL) ALL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bs ALL=(ALL:ALL) ALL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">%wheel ALL=(ALL:ALL) ALL
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后使用 &lt;code>exit&lt;/code> 退出 Arch 交互界面，打开 Powershell，切换到 Arch 目录，输入以下命令将默认登录用户切换为刚刚创建的新用户：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-powershell" data-lang="powershell">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="n">Arch&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="py">exe&lt;/span> &lt;span class="n">config&lt;/span> &lt;span class="p">-&lt;/span>&lt;span class="n">-default-user&lt;/span> &lt;span class="n">bs&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="配置-pacman">配置 Pacman&lt;/h2>
&lt;p>打开 Arch.exe 进入命令行。&lt;/p>
&lt;p>由于众所周知的原因，国内访问 Arch 的软件源十分缓慢，这里将源换为&lt;a class="link" href="https://mirrors.tuna.tsinghua.edu.cn/help/archlinux/" target="_blank" rel="noopener"
>清华大学开源镜像站的源&lt;/a>。&lt;/p>
&lt;p>编辑 &lt;code>/etc/pacman.d/mirrorlist&lt;/code>，往下翻找到 China 一栏，将 &lt;code>https://mirrors.tuna.tsinghua.edu.cn&lt;/code> 行取消注释。也可以多取消几个注释作为后备。如果懒得找也可以直接在文件开头添加：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Server = https://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>初始化 Pacman 的密钥环：&lt;/p>
&lt;div class="tip tip-note">
&lt;div class="tip-header">未创建新用户&lt;/div>
&lt;div class="tip-content">如果刚刚没有创建用来代替 &lt;code>root&lt;/code> 的新用户，请将本节命令中的 &lt;code>sudo&lt;/code> 去除，&lt;/div>
&lt;/div>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ sudo pacman-key --init
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo pacman-key --populate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo pacman -Syy archlinux-keyring
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>执行滚动更新：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ sudo pacman -Syu
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="tip tip-success">
&lt;div class="tip-header">搭建完成&lt;/div>
&lt;div class="tip-content">这样就配置好了一个基本的 Arch Linux 环境了，但仍然是一个空壳子，接下来给它配置一些常用服务。&lt;/div>
&lt;/div>
&lt;h2 id="安装包管理器-yay">安装包管理器 yay&lt;/h2>
&lt;p>yay 是一个广泛使用的 AUR Helper，解决了 pacman 无法安装 AUR 软件的问题，同时完全兼容 pacman 操作。&lt;/p>
&lt;p>首先安装必要软件包：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ sudo pacman -S base-devel git
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安装 &lt;code>yay-bin&lt;/code>（如果直接安装 &lt;code>yay&lt;/code> 则需要自己编译）：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">cd&lt;/span> ~
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ git clone https://aur.archlinux.org/yay-bin.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">cd&lt;/span> yay-bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ makepkg -si
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ yay
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="安装-oh-my-zsh">安装 oh-my-zsh&lt;/h2>
&lt;p>oh-my-zsh 是一个常用的 zsh 框架，提供了许多美观的主题和实用插件，能极大提升 shell 下的效率。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ yay -S zsh curl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sh -c &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安装基本插件，这里我安装了自己常用的 &lt;code>zsh-autosuggestions&lt;/code> 和 &lt;code>zsh-syntax-highlighting&lt;/code> 来提供自动补全和语法高亮。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">cd&lt;/span> ~/.oh-my-zsh/plugins
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ git clone https://github.com/zsh-users/zsh-autosuggestions.git --depth &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ git clone https://github.com/zsh-users/zsh-syntax-highlighting.git --depth &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>编辑 &lt;code>~/.zshrc&lt;/code>，找到 &lt;code>plugins&lt;/code>，在 &lt;code>git&lt;/code> 后面添加插件名称，使用空格或空行分隔。也可以往上找到 &lt;code>ZSH_THEME&lt;/code> 并修改主题。&lt;/p>
&lt;p>&lt;img src="https://sorabs.cc/posts/wsl2-arch/omz-preview.png"
width="678"
height="164"
srcset="https://sorabs.cc/posts/wsl2-arch/omz-preview_huecbecf8c43e4bdff720ec85fb621e261_12062_480x0_resize_box_3.png 480w, https://sorabs.cc/posts/wsl2-arch/omz-preview_huecbecf8c43e4bdff720ec85fb621e261_12062_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="最终效果，主题使用 ys"
class="gallery-image"
data-flex-grow="413"
data-flex-basis="992px"
>&lt;/p></description></item></channel></rss>